# singularity image based on ubuntu docker container
# functioning version
# how to build: 
Bootstrap: docker
#From: continuumio/miniconda3
From: continuumio/miniconda3:23.10.0-1

%setup

%files
    environment_manual.yml
    atmodata /opt/atmodata

%environment


%post
    #/opt/conda/bin/conda env create -f environment_manual.yml
    #/opt/conda/envs/model/bin/pip install -e /opt/atmodata
    conda env create -f environment_manual.yml
    #pip install -e /opt/atmodata


# not installed pynio

%test

%runscript
#    exec /opt/conda/envs/$(head -n 1 environment.yml | cut -f 2 -d ' ')/bin/"$@"
    exec /opt/conda/envs/model/bin/python

# running with weather
# singularity exec --nv --bind /mnt/ssd2/Master/Singularity/ plot_libraries.sif /opt/conda/envs/weather/bin/python test.py
# running with model
# singularity exec --nv --bind /mnt/ssd2/Master/Singularity/ model_libraries.sif /opt/conda/envs/model/bin/python test.py
# build
# sudo singularity build --sandbox sfno_packages7.sif model_singularity.def
