# singularity image based on ubuntu docker container
# functioning version
# how to build: 
Bootstrap: docker
#From: continuumio/miniconda3
From: continuumio/miniconda3:23.10.0-1

%setup

%files
    environment_wb2.yml
    /weatherbench2

%environment


%post
    #/opt/conda/bin/conda env create -f environment_wb2.yml
    conda env create -f environment_wb2.yml
    apt update
    apt upgrade -y 
    apt-get -y install git
    cd /weatherbench2
    pip install .


# not installed pynio

%test

%runscript
#    exec /opt/conda/envs/$(head -n 1 environment.yml | cut -f 2 -d ' ')/bin/"$@"
#   . /opt/conda/etc/profile.d/conda.sh # to init conda correctly to be able to use conda activate model e.g.
    exec /opt/conda/envs/model/bin/python

# running with weather
# singularity exec --nv --bind /mnt/ssd2/Master/Singularity/ plot_libraries.sif /opt/conda/envs/weather/bin/python test.py
# running with model
# singularity exec --nv --bind /mnt/ssd2/Master/Singularity/ model_libraries.sif /opt/conda/envs/model/bin/python test.py
# build
# sudo singularity build --sandbox sfno_packages7.sif model_singularity.def
